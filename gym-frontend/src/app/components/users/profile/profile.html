<div class="profile-page min-vh-100 d-flex flex-column">
  <!-- Κύριο περιεχόμενο -->
  <main class="flex-grow-1 py-4">
    <div class="container">
      <!-- Επικεφαλίδα σελίδας -->
      <div class="mb-4">
        <h1 class="display-5 fw-bold">
          Ο Λογαριασμός Μου
        </h1>
        <p class="lead">Διαχειριστείτε τα προσωπικά σας στοιχεία</p>
      </div>

      <!-- Ειδοποίηση μηνύματος -->
      @if (message) {
        <div class="alert alert-{{messageType === 'success' ? 'success' : 'danger'}}">
          {{message}}
        </div>
      }

      <!-- Κατάσταση φόρτωσης -->
      @if (isLoading) {
        <div class="text-center py-5">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Φόρτωση...</span>
          </div>
          <p class="mt-3">Φόρτωση προφίλ...</p>
        </div>
      }

      <!-- Περιεχόμενο προφίλ -->
      @if (!isLoading && user) {
        <div class="row">
          <!-- Αριστερή στήλη - Πληροφορίες προφίλ -->
          <div class="col-lg-4 mb-4">
            <div class="card shadow-sm h-100">
              <div class="card-body text-center">
                <!-- Εικονίδιο χρήστη -->
                <div class="mb-3">
                  <div class="bg-primary rounded-circle d-flex align-items-center justify-content-center mx-auto"
                       style="width: 120px; height: 120px;">
                    <span class="display-4 text-white fw-bold">
                      {{user.firstname.charAt(0)}}{{user.lastname.charAt(0)}}
                    </span>
                  </div>
                </div>
                
                <!-- Στοιχεία χρήστη -->
                <h4 class="card-title">{{user.firstname}} {{user.lastname}}</h4>
                <p class="card-text text-muted">
                  {{user.email}}
                </p>
                
                @if (user.phone) {
                  <p class="card-text text-muted">
                    {{user.phone}}
                  </p>
                }
                
                <!-- Πληροφορίες μέλους -->
                <div class="mt-4">
                  <div class="d-flex justify-content-between mb-2">
                    <span>Μέλος Από:</span>
                    <strong>{{user.joinDate | date:'mediumDate'}}</strong>
                  </div>
                  <div class="d-flex justify-content-between mb-2">
                    <span>Κατάσταση:</span>
                    <span class="badge bg-success">Ενεργό</span>
                  </div>
                  <div class="d-flex justify-content-between">
                    <span>Ρόλος:</span>
                    <span class="badge bg-{{user.role === 'ADMIN' ? 'primary' : 'warning'}}">
                      {{user.role}}
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Δεξιά στήλη - Φόρμα προφίλ -->
          <div class="col-lg-8">
            <div class="card shadow-sm">
              <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">
                  Προσωπικά Στοιχεία
                </h5>
                <button class="btn btn-{{isEditing ? 'secondary' : 'warning'}} btn-sm"
                        (click)="toggleEdit()">
                  {{isEditing ? 'Ακύρωση' : 'Επεξεργασία Προφίλ'}}
                </button>
              </div>
              
              <div class="card-body">
                <form [formGroup]="profileForm" class="d-flex flex-column gap-3">
                  <!-- Προβολή μόνο -->
                  @if (!isEditing) {
                    <div class="row">
                      <div class="col-md-6">
                        <div class="mb-3">
                          <label class="form-label fw-semibold">Όνομα</label>
                          <div class="form-control-plaintext">{{user.firstname}}</div>
                        </div>
                      </div>
                      <div class="col-md-6">
                        <div class="mb-3">
                          <label class="form-label fw-semibold">Επώνυμο</label>
                          <div class="form-control-plaintext">{{user.lastname}}</div>
                        </div>
                      </div>
                    </div>
                    
                    <div class="mb-3">
                      <label class="form-label fw-semibold">Email</label>
                      <div class="form-control-plaintext">{{user.email}}</div>
                      <small class="text-muted">
                        <i class="bi bi-envelope me-1"></i>
                        Το email χρησιμοποιείται για σύνδεση
                      </small>
                    </div>
                    
                    @if (user.phone) {
                      <div class="mb-3">
                        <label class="form-label fw-semibold">Τηλέφωνο</label>
                        <div class="form-control-plaintext">{{user.phone}}</div>
                      </div>
                    }
                  } @else {
                    <!-- Λειτουργία επεξεργασίας -->
                    <div class="row">
                      <div class="col-md-6">
                        <div class="mb-3">
                          <label for="firstname" class="form-label fw-semibold">
                            Όνομα *
                          </label>
                          <input type="text" class="form-control" id="firstname" 
                                 formControlName="firstname"
                                 [class.is-invalid]="firstname?.invalid && firstname?.touched">
                          @if (firstname?.invalid && firstname?.touched) {
                            <div class="invalid-feedback">
                              @if (firstname?.errors?.['required']) {
                                <div>Το όνομα είναι απαραίτητο</div>
                              }
                              @if (firstname?.errors?.['minlength']) {
                                <div>Ελάχιστο 2 χαρακτήρες απαιτούνται</div>
                              }
                            </div>
                          }
                        </div>
                      </div>
                      <div class="col-md-6">
                        <div class="mb-3">
                          <label for="lastname" class="form-label fw-semibold">
                            Επώνυμο *
                          </label>
                          <input type="text" class="form-control" id="lastname" 
                                 formControlName="lastname"
                                 [class.is-invalid]="lastname?.invalid && lastname?.touched">
                          @if (lastname?.invalid && lastname?.touched) {
                            <div class="invalid-feedback">
                              @if (lastname?.errors?.['required']) {
                                <div>Το επώνυμο είναι απαραίτητο</div>
                              }
                              @if (lastname?.errors?.['minlength']) {
                                <div>Ελάχιστο 2 χαρακτήρες απαιτούνται</div>
                              }
                            </div>
                          }
                        </div>
                      </div>
                    </div>
                    
                    <div class="mb-3">
                      <label for="email" class="form-label fw-semibold">
                        Email *
                      </label>
                      <input type="email" class="form-control" id="email" 
                             formControlName="email"
                             [class.is-invalid]="email?.invalid && email?.touched"
                             [disabled]="false">
                      @if (email?.invalid && email?.touched) {
                        <div class="invalid-feedback">
                          @if (email?.errors?.['required']) {
                            <div>Το email είναι απαραίτητο</div>
                          }
                          @if (email?.errors?.['email']) {
                            <div>Μη έγκυρη μορφή email</div>
                          }
                        </div>
                      }
                      <small class="text-muted">
                        <i class="bi bi-envelope me-1"></i>
                        Το email χρησιμοποιείται για σύνδεση. Ελέξτε την ορθογραφία, θα χρησιμοποιείται για μελλοντικές συνδέσεις.
                      </small>
                    </div>
                    
                    <div class="mb-3">
                      <label for="phone" class="form-label fw-semibold">Τηλέφωνο</label>
                      <input type="tel" class="form-control" id="phone" 
                             formControlName="phone"
                             placeholder="Προαιρετικός αριθμός τηλεφώνου">
                    </div>
                    
                    <!-- Αλλαγή κωδικού -->
                    <div class="card border-primary mt-4">
                      <div class="card-header bg-primary text-white">
                        <h6 class="mb-0">
                          Αλλαγή Κωδικού
                        </h6>
                      </div>
                      <div class="card-body">
                        <p class="small text-muted mb-3">
                          Αφήστε κενά αν δεν θέλετε να αλλάξετε τον κωδικό σας
                        </p>

                        <div class="row">
                          <div class="col-md-6">
                            <div class="mb-3">
                              <label for="newPassword" class="form-label">Νέος Κωδικός</label>
                              <input type="password" class="form-control" id="newPassword"
                                     formControlName="newPassword"
                                     [class.is-invalid]="newPassword?.invalid && newPassword?.touched">
                              @if (newPassword?.invalid && newPassword?.touched) {
                                <div class="invalid-feedback">
                                  Ελάχιστο 6 χαρακτήρες απαιτούνται
                                </div>
                              }
                            </div>
                          </div>
                          <div class="col-md-6">
                            <div class="mb-3">
                              <label for="confirmPassword" class="form-label">
                                Επιβεβαίωση Κωδικού
                              </label>
                              <input type="password" class="form-control" id="confirmPassword"
                                     formControlName="confirmPassword"
                                     [class.is-invalid]="confirmPassword?.invalid && confirmPassword?.touched">
                              @if (confirmPassword?.errors?.['passwordMismatch']) {
                                <div class="invalid-feedback">
                                  Οι κωδικοί δεν ταιριάζουν
                                </div>
                              }
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    
                    <!-- Κουμπιά αποθήκευσης -->
                    <div class="d-flex justify-content-end gap-2 mt-4">
                      <button type="button" class="btn btn-secondary" 
                              (click)="toggleEdit()" [disabled]="isSaving">
                        Ακύρωση
                      </button>
                      <button type="button" class="btn bg-warning" 
                              (click)="saveProfile()" [disabled]="profileForm.invalid || isSaving">
                        @if (isSaving) {
                          <span class="spinner-border spinner-border-sm me-2" 
                                role="status" aria-hidden="true"></span>
                          Αποθήκευση...
                        } @else {
                          Αποθήκευση Αλλαγών
                        }
                      </button>
                    </div>
                  }
                </form>
              </div>
            </div>
          </div>
        </div>
      }
    </div>
  </main>
</div>